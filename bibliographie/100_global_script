DROP TABLE IF EXISTS all_documents;

CREATE TABLE all_documents (
    id serial,
	sch_identifiant varchar(32),
	doc text[]
);

-- on sélectionne tous les documents référencés dans une table temporaire
-- en gardant la souche qui identifiait chaque document
-- 37727 documents
INSERT INTO all_documents
SELECT ROW_NUMBER() OVER (ORDER BY 1) AS id, sch_identifiant,
string_to_array(trim(unnest(
	string_to_array(regexp_replace(sch_bibliographie, E'[\\n\\r\\f\\u000B\\u0085\\u2028\\u2029]+', ' ', 'g'), ';')
)), ',') AS doc
FROM t_souche;

-- puis on commence à vider cette table temporaire pour ajouter 
